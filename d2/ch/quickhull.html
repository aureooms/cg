<!DOCTYPE html><html lang="en"><head><title>d2/ch/quickhull</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="d2/ch/quickhull"><meta name="groc-project-path" content="js/src/d2/ch/quickhull.js"><meta name="groc-github-url" content="https://github.com/aureooms/js-cg"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/aureooms/js-cg/blob/master/js/src/d2/ch/quickhull.js">js/src/d2/ch/quickhull.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>From Wikipedia :</p>
<p>QuickHull
Discovered independently in 1977 by W. Eddy and in 1978 by A. Bykat.
Just like the quicksort algorithm, it has the expected time complexity
of O(n log n), but may degenerate to \u0398(nh) = O(n2) in the worst case.</p>
<p>-&gt; <a href="https://en.wikipedia.org/wiki/QuickHull">https://en.wikipedia.org/wiki/QuickHull</a></p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> quickhull = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(set)</span>{</span>
	<span class="hljs-keyword">if</span>(set.length &lt; <span class="hljs-number">4</span>) <span class="hljs-keyword">return</span> set.slice();

	<span class="hljs-keyword">var</span> b0 = find_min_y(set, <span class="hljs-number">0</span>, set.length);
	set[<span class="hljs-number">0</span>] = [set[b0], set[b0] = set[<span class="hljs-number">0</span>]][<span class="hljs-number">0</span>];
	b0 = <span class="hljs-number">0</span>;

	<span class="hljs-keyword">var</span> b1 = find_max_y(set, <span class="hljs-number">1</span>, set.length);
	set[<span class="hljs-number">1</span>] = [set[b1], set[b1] = set[<span class="hljs-number">1</span>]][<span class="hljs-number">0</span>];
	b1 = <span class="hljs-number">1</span>;

	<span class="hljs-keyword">var</span> b2, b3, b2_m, b3_m, l = <span class="hljs-number">2</span>, r = e = set.length - <span class="hljs-number">1</span>;

	<span class="hljs-keyword">while</span>(l &lt;= r){
		<span class="hljs-keyword">var</span> sin = sin_sign(set[b0], set[b1], set[l]);
		<span class="hljs-keyword">if</span>(sin &gt; <span class="hljs-number">0</span>){
			<span class="hljs-keyword">var</span> d = dist_pl(set[l], [set[b0], set[b1]]);
			<span class="hljs-keyword">if</span>(b2 === <span class="hljs-literal">undefined</span> || d &gt; b2_m){
				b2 = l;
				b2_m = d;
			}
			++l;
		}
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(sin &lt; <span class="hljs-number">0</span>){
			set[l] = [set[r], set[r] = set[l]][<span class="hljs-number">0</span>];
			<span class="hljs-keyword">var</span> d = dist_pl(set[r], [set[b0], set[b1]]);
			<span class="hljs-keyword">if</span>(b3 === <span class="hljs-literal">undefined</span> || d &gt; b3_m){
				b3 = r;
				b3_m = d;
			}
			--r;
		}
		<span class="hljs-keyword">else</span>{
			<span class="hljs-keyword">if</span>(b3 === e) b3 = r;
			<span class="hljs-keyword">if</span>(l != r) set[e] = [set[r], set[r] = set[e]][<span class="hljs-number">0</span>];
			set[l] = [set[e], set[e] = set[l]][<span class="hljs-number">0</span>];
			--e;
			--r;
		}
	}


	<span class="hljs-keyword">var</span> ch = [];

	ch.push(set[b0]);
	<span class="hljs-keyword">if</span>(b2 !== <span class="hljs-literal">undefined</span>){
		set[b2] = [set[<span class="hljs-number">2</span>], set[<span class="hljs-number">2</span>] = set[b2]][<span class="hljs-number">0</span>];
		b2 = <span class="hljs-number">2</span>;
		quick_hull_rec(set, <span class="hljs-number">3</span>, r, b0, b1, b2, ch);
	}

	ch.push(set[b1]);
	<span class="hljs-keyword">if</span>(b3 !== <span class="hljs-literal">undefined</span>){
		set[b3] = [set[r+<span class="hljs-number">1</span>], set[r+<span class="hljs-number">1</span>] = set[b3]][<span class="hljs-number">0</span>];
		b3 = r + <span class="hljs-number">1</span>;
		quick_hull_rec(set, r + <span class="hljs-number">2</span>, e, b1, b0, b3, ch);
	}

	<span class="hljs-keyword">return</span> ch;
};

<span class="hljs-keyword">var</span> quick_hull_rec = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(set, l, r, b0, b1, b2, ch)</span>{</span>

	<span class="hljs-keyword">var</span> b3, b4, b3_m, b4_m, e = r, f = l;

	<span class="hljs-keyword">while</span>(l &lt;= r){
		<span class="hljs-keyword">if</span>(sin_sign(set[b2], set[b1], set[l]) &gt; <span class="hljs-number">0</span>){
			<span class="hljs-keyword">var</span> d = dist_pl(set[l], [set[b2], set[b1]]);
			<span class="hljs-keyword">if</span>(b3 === <span class="hljs-literal">undefined</span> || d &gt; b3_m){
				b3 = l;
				b3_m = d;
			}
			++l;
		}
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(sin_sign(set[b0], set[b2], set[l]) &gt; <span class="hljs-number">0</span>){
			set[l] = [set[r], set[r] = set[l]][<span class="hljs-number">0</span>];
			<span class="hljs-keyword">var</span> d = dist_pl(set[r], [set[b0], set[b2]]);
			<span class="hljs-keyword">if</span>(b4 === <span class="hljs-literal">undefined</span> || d &gt; b4_m){
				b4 = r;
				b4_m = d;
			}
			--r;
		}
		<span class="hljs-keyword">else</span>{
			<span class="hljs-keyword">if</span>(b4 === e) b4 = r;
			<span class="hljs-keyword">if</span>(l != r) set[e] = [set[r], set[r] = set[e]][<span class="hljs-number">0</span>];
			set[l] = [set[e], set[e] = set[l]][<span class="hljs-number">0</span>];
			--e;
			--r;
		}
	}


	<span class="hljs-keyword">if</span>(b3 !== <span class="hljs-literal">undefined</span>){
		set[b3] = [set[f], set[f] = set[b3]][<span class="hljs-number">0</span>];
		b3 = f;
		quick_hull_rec(set, f + <span class="hljs-number">1</span>, r, b2, b1, b3, ch);

	}

	ch.push(set[b2]);

	<span class="hljs-keyword">if</span>(b4 !== <span class="hljs-literal">undefined</span>){
		set[b4] = [set[r+<span class="hljs-number">1</span>], set[r+<span class="hljs-number">1</span>] = set[b4]][<span class="hljs-number">0</span>];
		b4 = r + <span class="hljs-number">1</span>;
		quick_hull_rec(set, r + <span class="hljs-number">2</span>, e, b0, b2, b4, ch);

	}
};

exports.quickhull = quickhull;</div></div></div></div></body></html>